openapi: 3.1.0
info:
  title: Product API
  version: 1.0.0

paths:

  # Endpoint to get product information
  /products:
    get:
      summary: Get product information
      description: Returns a single product.
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ProductDTO"

  /products/items:
    get:
      summary: Get cart items
      description: Returns product info for the given IDs
      parameters:
      - in: query
        name: ids
        required: true
        explode: true
        schema:
          type: array
          items:
            type: string
            format: uuid
      responses:
        "200":
          description: Cart items found
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ProductReviewCheckoutDTO"

  /checkout/pricing:
    get:
      summary: get tax and shipping information
      description: returns tax and shipping prices
      responses:
        "200":
          description: Tax and shipping information
          content:
            application/json:
              schema:
                type: object
                properties:
                  tax:
                    type: number
                    format: double
                  shipping:
                    type: number
                    format: double

  #Auth 
  /auth/login:
    post:
      summary: Authenticate a user
      description: Accepts username and password and returns an auth token.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginDTO"
      responses:
        "200":
          description: Successful authentication
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "401":
          description: Invalid credentials
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Invalid username or password."

  #Admin Products

  # Create product
  /admin/products:
    post:
      summary: create product
      description: used to create a post
      responses:
        "200":
          description: Successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string

    # Get all products
    get:
      operationId: getAdminProducts
      summary: Get admin products (paged)
      tags:
      - AdminProducts
      parameters:
      - name: page
        in: query
        description: Zero-based page index
        required: false
        schema:
          type: integer
          minimum: 0
          default: 0
      - name: size
        in: query
        description: Page size
        required: false
        schema:
          type: integer
          minimum: 1
          maximum: 200
          default: 20
      - name: sort
        in: query
        description: Sort criteria in the format `property,asc|desc`. Can be repeated.
        required: false
        schema:
          type: array
          items:
            type: string
            example: "name,asc"
        style: form
        explode: true

      responses:
        "200":
          description: Page of admin products
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PageAdminProductDTO"
        "401":
          description: Unauthorized (missing/invalid token)
        "403":
          description: Forbidden (not allowed)

  #Get upload URL for post draft media

  /admin/products/{productId}/media:
    post:
      summary: Generate pre-signed URL for post draft media upload
      tags:
      - Media
      parameters:
      - name: productId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      responses:
        "200":
          description: Successfully generated upload URL
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InitializeMediaUploadDTO"
        "400":
          description: Invalid postDraftId or request format
        "404":
          description: Post draft not found
    #Confirm uploaded media

  /admin/products/{productId}/media/{mediaId}:
    put:
      summary: Confirm uploaded media for post draft
      tags:
      - Media
      parameters:
      - name: productId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: mediaId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      responses:
        "200":
          description: Successfully confirmed uploaded media
        "400":
          description: Invalid postDraftId or request format
        "404":
          description: Post draft or media not found
    #delete media from post draft

  /admin/products/{productId}/media/delete/{mediaId}:
    delete:
      summary: Delete media from post draft
      tags:
      - Media
      parameters:
      - name: productId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: mediaId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      responses:
        "200":
          description: Media deleted successfully
        "400":
          description: Invalid postDraftId or mediaId
        "404":
          description: Post draft or media not found

  /admin/products/{productId}:
    get:
      summary: Get media for a product
      tags:
      - Media
      parameters:
      - name: productId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      responses:
        "200":
          description: Successfully retrieved media
          content:
            application/json:
              schema:
                type: Object
                items:
                  $ref: "#/components/schemas/FullAdminProductDTO"
        "400":
          description: Invalid productId
        "404":
          description: Product not found
    put:
      summary: update product
      parameters:
      - name: productId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FullAdminProductDTO"
      responses:
        "200":
          description: Successfully updated product

    delete:
      summary: delete product
      parameters:
      - name: productId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      responses:
        "200":
          description: Successfully deleted product

  /admin/orders:
    get:
      operationId: getAdminOrders
      summary: Get admin orders (paged)
      tags:
      - AdminOrders
      parameters:
      - name: page
        in: query
        description: Zero-based page index
        required: false
        schema:
          type: integer
          minimum: 0
          default: 0
      - name: size
        in: query
        description: Page size
        required: false
        schema:
          type: integer
          minimum: 1
          maximum: 200
          default: 20
      - name: sort
        in: query
        description: Sort criteria in the format `property,asc|desc`. Can be repeated.
        required: false
        schema:
          type: array
          items:
            type: string
            example: "name,asc"
        style: form
        explode: true

      responses:
        "200":
          description: Page of admin products
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PageAdminOrderDTO"
        "401":
          description: Unauthorized (missing/invalid token)
        "403":
          description: Forbidden (not allowed)

  /admin/orders/paid:
    get:
      operationId: getAdminOrdersPaid
      summary: Get admin orders (paged)
      tags:
      - AdminOrders
      parameters:
      - name: page
        in: query
        description: Zero-based page index
        required: false
        schema:
          type: integer
          minimum: 0
          default: 0
      - name: size
        in: query
        description: Page size
        required: false
        schema:
          type: integer
          minimum: 1
          maximum: 200
          default: 20
      - name: sort
        in: query
        description: Sort criteria in the format `property,asc|desc`. Can be repeated.
        required: false
        schema:
          type: array
          items:
            type: string
            example: "name,asc"
        style: form
        explode: true

      responses:
        "200":
          description: Page of admin products
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PageAdminOrderDTO"
        "401":
          description: Unauthorized (missing/invalid token)
        "403":
          description: Forbidden (not allowed)

  /admin/orders/{orderId}:
    get:
      tags:
      - AdminOrders
      operationId: getAdminOrderById
      summary: Get an individual order by id
      parameters:
      - name: orderId
        in: path
        required: true
        description: The order id
        schema:
          type: string
      responses:
        "200":
          description: The order details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IndividualOrderDTO"
        "404":
          description: Order not found
        "401":
          description: Unauthorized

  /admin/orders/{orderId}/fulfill:
    post:
      tags:
      - AdminOrders
      operationId: fulfillAdminOrder
      summary: Mark an order as fulfilled
      parameters:
      - name: orderId
        in: path
        required: true
        description: The order ID to mark as fulfilled
        schema:
          type: string
      responses:
        "200":
          description: Order successfully marked as fulfilled
        "404":
          description: Order not found
        "401":
          description: Unauthorized

components:

  # Security Schemes
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:

    # Definition of ProductDTO schema
    ProductDTO:
      type: object
      properties:
        id:
          type: string
          example: "prod_123"
        title:
          type: string
          example: "Wireless Headphones"
        price:
          type: number
          format: float
          example: 79.99
        description:
          type: string
          example: "Noise-cancelling over-ear wireless headphones."
        thumbnail:
          type: string
          example: "https://cdn.example.com/products/abc-thumb.jpg"
      required:
      - id
      - title
      - price
      - description
      - thumbnail
      # Definition of LoginDTO schema
    LoginDTO:
      type: object
      properties:
        username:
          type: string
          example: chris_farah
        password:
          type: string
          format: password
          example: superSecret123
      required:
      - username
      - password

    #Responses

    # Definition of AuthResponse schema
    AuthResponse:
      type: object
      properties:
        token:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        role:
          type: string
          example: "admin"
      required:
      - token

    AdminProductDTO:
      type: object
      required:
      - thumbnail
      - productId
      - price
      - name
      properties:
        thumbnail:
          type: string
          description: URL or key to the product thumbnail image
          example: "https://cdn.example.com/products/abc-thumb.jpg"
        productId:
          type: string
          format: uuid
          example: "3fa85f64-5717-4562-b3fc-2c963f66afa6"
        price:
          type: number
          format: double
          example: 29.99
        name:
          type: string
          example: "Mantra Calendar 2026"

    AdminOrderDTO:
      type: object
      required:
      - id
      - orderStatus
      - timestamp
      properties:
        id:
          type: string
        orderStatus:
          type: string
        timestamp:
          type: string

    # Spring Page<T>-style response
    PageAdminProductDTO:
      type: object
      required:
      - content
      - pageable
      - totalElements
      - totalPages
      - size
      - number
      - numberOfElements
      - first
      - last
      - empty
      properties:
        content:
          type: array
          items:
            $ref: "#/components/schemas/AdminProductDTO"

        pageable:
          $ref: "#/components/schemas/Pageable"

        totalElements:
          type: integer
          format: int64
          example: 125
        totalPages:
          type: integer
          format: int32
          example: 7
        size:
          type: integer
          format: int32
          example: 20
        number:
          type: integer
          format: int32
          description: Current page number (zero-based)
          example: 0
        numberOfElements:
          type: integer
          format: int32
          example: 20
        first:
          type: boolean
          example: true
        last:
          type: boolean
          example: false
        empty:
          type: boolean
          example: false

        sort:
          $ref: "#/components/schemas/Sort"

    PageAdminOrderDTO:
      # Spring Page<T>-style response
      PageAdminProductDTO:
        type: object
        required:
        - content
        - pageable
        - totalElements
        - totalPages
        - size
        - number
        - numberOfElements
        - first
        - last
        - empty
        properties:
          content:
            type: array
            items:
              $ref: "#/components/schemas/AdminOrderDTO"

          pageable:
            $ref: "#/components/schemas/Pageable"

          totalElements:
            type: integer
            format: int64
            example: 125
          totalPages:
            type: integer
            format: int32
            example: 7
          size:
            type: integer
            format: int32
            example: 20
          number:
            type: integer
            format: int32
            description: Current page number (zero-based)
            example: 0
          numberOfElements:
            type: integer
            format: int32
            example: 20
          first:
            type: boolean
            example: true
          last:
            type: boolean
            example: false
          empty:
            type: boolean
            example: false

          sort:
            $ref: "#/components/schemas/Sort"

    Pageable:
      type: object
      required:
      - pageNumber
      - pageSize
      - offset
      - paged
      - unpaged
      properties:
        pageNumber:
          type: integer
          format: int32
          example: 0
        pageSize:
          type: integer
          format: int32
          example: 20
        offset:
          type: integer
          format: int64
          example: 0
        paged:
          type: boolean
          example: true
        unpaged:
          type: boolean
          example: false
        sort:
          $ref: "#/components/schemas/Sort"

    Sort:
      type: object
      required:
      - empty
      - sorted
      - unsorted
      properties:
        empty:
          type: boolean
          example: false
        sorted:
          type: boolean
          example: true
        unsorted:
          type: boolean
          example: false

    InitializeMediaUploadDTO:
      type: object
      properties:
        uploadUrl:
          type: string
          format: uri
        mediaId:
          type: string
          format: uuid
      required:
      - uploadUrl
      - mediaId

    FullAdminProductDTO:
      type: object
      required:
      - id
      - sku
      - isActive
      - title
      - price
      - inventoryQty
      - description
      - thumbnails
      properties:
        id:
          type: string
          format: uuid
          example: "3fa85f64-5717-4562-b3fc-2c963f66afa6"
        title:
          type: string
          example: "Mantra Calendar 2026"
        price:
          type: number
          format: double
          example: 29.99
        inventoryQty:
          type: integer
          format: int32
          example: 100
        description:
          type: string
          example: "A stylish and functional calendar for the year 2026."
        thumbnails:
          type: array
          items:
            type: string
            format: uri
          example: [ "https://cdn.example.com/products/abc-thumb.jpg" ]
        sku:
          type: string
          example: "MTR-2026"
        isActive:
          type: boolean
          example: true

    ProductReviewCheckoutDTO:
      type: object
      properties:
        title:
          type: string
        price:
          type: number
          format: double
        id:
          type: string
          format: uuid
        thumbnail:
          type: string
      required:
      - title
      - price
      - productId
      - thumbnail
    IndividualOrderDTO:
      type: object
      required:
      - Name
      - email
      - total
      - tax
      - shipping
      - address
      - orderItems
      properties:
        Name:
          type: string
        email:
          type: string
          format: email
        total:
          type: number
          format: double
        tax:
          type: number
          format: double
        shipping:
          type: number
          format: double
        address:
          $ref: "#/components/schemas/AddressDTO"
        orderItems:
          type: array
          items:
            $ref: "#/components/schemas/OrderItemDTO"

    AddressDTO:
      type: object
      required:
      - addressType
      - line1
      - city
      - state
      - postalCode
      - countryCode
      properties:
        addressType:
          $ref: "#/components/schemas/AddressType"
        line1:
          type: string
          maxLength: 255
        line2:
          type: string
          maxLength: 255
          nullable: true
        city:
          type: string
          maxLength: 100
        state:
          type: string
          maxLength: 100
        postalCode:
          type: string
          maxLength: 20
        countryCode:
          type: string
          maxLength: 2
          description: ISO 3166-1 alpha-2 country code (e.g. "US", "DE")

    OrderItemDTO:
      type: object
      required:
      - id
      - title
      - thumbnail
      - quantity
      - unit_price
      - total_price
      properties:
        id:
          type: string
        title:
          type: string
        thumbnail:
          type: string
          description: URL to thumbnail image
        quantity:
          type: integer
          format: int32
          minimum: 1
        unit_price:
          type: number
          format: double
        total_price:
          type: number
          format: double

    AddressType:
      type: string
      description: Type of address (shipping or billing)
      enum:
      - SHIPPING
      - BILLING
